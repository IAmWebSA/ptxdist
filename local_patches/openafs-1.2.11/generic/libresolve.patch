# 
# Submitted:
#
# Leif Johansson <leifj@it.su.se>, 2004-06-11
#
# Error: 
#
# Description: 
#
#	It patches the makefiles to include -libresolv which 
#	you need if you are building using uClibc (and which 
#	doesn't seem to hurt if you don't). It may end up in
#	the openafs sources eventually. I'm not sure if I got
#	the openafs-ptx-build.make makefile right however.
#
# State:
#
#	not testet at PTX 
#

--- openafs-1.2.11/./src/afsd/Makefile.in	2003-10-24 07:24:41.000000000 +0200
+++ openafs-1.2.11-su/./src/afsd/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -46,7 +46,7 @@
 # Programs
 #
 
-AFSLIBS=${TOP_LIBDIR}/libauth.a ${TOP_LIBDIR}/libcmd.a ${TOP_LIBDIR}/libsys.a ${TOP_LIBDIR}/util.a ${TOP_LIBDIR}/librx.a ${TOP_LIBDIR}/liblwp.a ${TOP_LIBDIR}/util.a
+AFSLIBS=${TOP_LIBDIR}/libauth.a ${TOP_LIBDIR}/libcmd.a ${TOP_LIBDIR}/libsys.a ${TOP_LIBDIR}/util.a ${TOP_LIBDIR}/librx.a ${TOP_LIBDIR}/liblwp.a ${TOP_LIBDIR}/util.a -lresolv
 
 afsd: afsd.o $(AFSLIBS)
 	case ${SYS_NAME} in \
--- openafs-1.2.11/./src/auth/Makefile.in	2003-07-07 22:16:28.000000000 +0200
+++ openafs-1.2.11-su/./src/auth/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -39,7 +39,7 @@
 LIBS=libauth.a ${TOP_LIBDIR}/libsys.a \
       ${TOP_LIBDIR}/librxkad.a ${TOP_LIBDIR}/libdes.a \
       ${TOP_LIBDIR}/librx.a ${TOP_LIBDIR}/libsys.a \
-      ${TOP_LIBDIR}/liblwp.a ${TOP_LIBDIR}/util.a
+      ${TOP_LIBDIR}/liblwp.a ${TOP_LIBDIR}/util.a -lresolv
 INCLS=cellconfig.h auth.h keys.h
 KSRCS=auth.h
 UKSRCS=${KSRCS} cellconfig.h acfg_errors.c keys.h cellconfig.c \
--- openafs-1.2.11/./src/bozo/Makefile.in	2003-07-01 21:03:54.000000000 +0200
+++ openafs-1.2.11-su/./src/bozo/Makefile.in	2004-06-02 02:48:42.000000000 +0200
@@ -55,7 +55,7 @@
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/util.a \
 	${TOP_LIBDIR}/libsys.a \
-	${TOP_LIBDIR}/libprocmgmt.a
+	${TOP_LIBDIR}/libprocmgmt.a -lresolv
 
 OBJS=bosserver.o bnode.o ezbnodeops.o fsbnodeops.o bosint.ss.o bosint.xdr.o \
 bosoprocs.o cronbnodeops.o
--- openafs-1.2.11/./src/bucoord/Makefile.in	2001-09-08 01:34:50.000000000 +0200
+++ openafs-1.2.11-su/./src/bucoord/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -40,7 +40,7 @@
         ${TOP_LIBDIR}/libsys.a   ${TOP_LIBDIR}/libdes.a \
         ${TOP_LIBDIR}/librx.a  ${TOP_LIBDIR}/libsys.a \
         ${TOP_LIBDIR}/liblwp.a ${TOP_LIBDIR}/libcmd.a \
-        ${TOP_LIBDIR}/libcom_err.a ${TOP_LIBDIR}/util.a
+        ${TOP_LIBDIR}/libcom_err.a ${TOP_LIBDIR}/util.a -lresolv
 
 all: ${TOP_LIBDIR}/libbxdb.a backup
 
--- openafs-1.2.11/./src/budb/Makefile.in	2003-07-01 21:15:36.000000000 +0200
+++ openafs-1.2.11-su/./src/budb/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -61,7 +61,7 @@
 	${TOP_LIBDIR}/liblwp.a \
 	${TOP_LIBDIR}/libcmd.a \
 	${TOP_LIBDIR}/libcom_err.a \
-	${TOP_LIBDIR}/util.a
+	${TOP_LIBDIR}/util.a -lresolv
 
 COMMON_OBJS = database.o db_alloc.o db_dump.o db_hash.o struct_ops.o ol_verify.o
 
--- openafs-1.2.11/./src/butc/Makefile.in	2003-10-24 07:24:45.000000000 +0200
+++ openafs-1.2.11-su/./src/butc/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -67,7 +67,7 @@
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/util.a \
 	${TOP_LIBDIR}/libusd.a \
-	${TOP_LIBDIR}/libprocmgmt.a
+	${TOP_LIBDIR}/libprocmgmt.a -lresolv
 
 TESTOBJS=test.o
 
--- openafs-1.2.11/./src/dauth/Makefile.in	2003-07-01 21:03:58.000000000 +0200
+++ openafs-1.2.11-su/./src/dauth/Makefile.in	2004-06-02 02:42:30.000000000 +0200
@@ -52,7 +52,7 @@
 		${TOP_LIBDIR}/librx.a \
 	        ${TOP_LIBDIR}/liblwp.a \
 	       	${TOP_LIBDIR}/libsys.a \
-		${TOP_LIBDIR}/util.a
+		${TOP_LIBDIR}/util.a -lresolv
 
 CELL=		`pwd|awk -F/ '{print $$3}'`
 USNS=		cellname
--- openafs-1.2.11/./src/fsprobe/Makefile.in	2003-07-02 08:36:15.000000000 +0200
+++ openafs-1.2.11-su/./src/fsprobe/Makefile.in	2004-06-02 02:47:23.000000000 +0200
@@ -53,7 +53,7 @@
 	${TOP_LIBDIR}/librx.a \
 	${TOP_LIBDIR}/liblwp.a \
 	${TOP_LIBDIR}/libsys.a \
-	${TOP_LIBDIR}/util.a
+	${TOP_LIBDIR}/util.a -lresolv
 
 all: ${TOP_INCDIR}/afs/fsprobe.h ${TOP_LIBDIR}/libfsprobe.a fsprobe_test
 
--- openafs-1.2.11/./src/kauth/Makefile.in	2003-07-07 22:16:33.000000000 +0200
+++ openafs-1.2.11-su/./src/kauth/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -54,7 +54,7 @@
 	${TOP_LIBDIR}/libcmd.a \
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/util.a \
-	$(DBM)
+	$(DBM) -lresolv
 
 UKSRCS=authclient.c user.c kautils.h kaserver.h kaaux.c token.c \
        kalocalcell.c client.c kaerrors.c
@@ -70,7 +70,7 @@
 	${TOP_LIBDIR}/libdes.a \
 	${TOP_LIBDIR}/libcmd.a \
 	${TOP_LIBDIR}/libcom_err.a \
-	${TOP_LIBDIR}/util.a
+	${TOP_LIBDIR}/util.a -lresolv
 
 OBJS=kauth.xdr.o kauth.cs.o kaaux.o client.o authclient.o token.o kautils.o kalocalcell.o kaerrors.o user.o krb_tf.o 
 KOBJS=kauth.xdr.o kauth.cs.o kaaux.o client.o authclient.o token.o kautils.o kalocalcell.o kaerrors.o user.krb.o krb_tf.o
--- openafs-1.2.11/./src/libadmin/samples/Makefile.in	2001-09-08 01:35:16.000000000 +0200
+++ openafs-1.2.11-su/./src/libadmin/samples/Makefile.in	2004-06-02 02:52:11.000000000 +0200
@@ -60,7 +60,7 @@
 	${TOP_LIBDIR}/libvosadmin.a \
 	${TOP_LIBDIR}/libbosadmin.a \
 	${TOP_LIBDIR}/libafsauthent.a \
-	${TOP_LIBDIR}/libafsrpc.a
+	${TOP_LIBDIR}/libafsrpc.a -lresolv
 
 cm_client_config: cm_client_config.o $(SAMPLELIBS)
 	$(CC) $(LDFLAGS) -o $@ $@.o $(SAMPLELIBS) $(MTLIBS) $(XLIBS)
--- openafs-1.2.11/./src/libadmin/test/Makefile.in	2001-09-08 01:35:16.000000000 +0200
+++ openafs-1.2.11-su/./src/libadmin/test/Makefile.in	2004-06-02 02:51:48.000000000 +0200
@@ -40,7 +40,7 @@
 	$(TOP_LIBDIR)/libptsadmin.a \
 	$(TOP_LIBDIR)/libafsauthent.a \
 	$(TOP_LIBDIR)/libafsrpc.a \
-	$(TOP_LIBDIR)/libcmd.a  # static library
+	$(TOP_LIBDIR)/libcmd.a -lresolv # static library
 
 AFSCPOBJS =\
 	bos.o \
--- openafs-1.2.11/./src/log/Makefile.in	2001-09-08 01:35:25.000000000 +0200
+++ openafs-1.2.11-su/./src/log/Makefile.in	2004-06-02 02:46:50.000000000 +0200
@@ -42,14 +42,14 @@
 		${TOP_LIBDIR}/libsys.a ${TOP_LIBDIR}/librx.a \
 		${TOP_LIBDIR}/libsys.a \
 	        ${TOP_LIBDIR}/liblwp.a ${TOP_LIBDIR}/libcmd.a \
-	        ${TOP_LIBDIR}/util.a
+	        ${TOP_LIBDIR}/util.a -lresolv
 KLIBRARIES=${TOP_LIBDIR}/libauth.krb.a \
 		${TOP_LIBDIR}/librxkad.a \
 		${TOP_LIBDIR}/libdes.a \
 		${TOP_LIBDIR}/libsys.a ${TOP_LIBDIR}/librx.a \
 		${TOP_LIBDIR}/libsys.a \
 	        ${TOP_LIBDIR}/liblwp.a ${TOP_LIBDIR}/libcmd.a \
-	        ${TOP_LIBDIR}/util.a
+	        ${TOP_LIBDIR}/util.a -lresolv
 
 #
 # Main targets
--- openafs-1.2.11/./src/ptserver/Makefile.in	2003-10-24 07:25:03.000000000 +0200
+++ openafs-1.2.11-su/./src/ptserver/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -59,7 +59,7 @@
 	${TOP_LIBDIR}/libdes.a \
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/util.a \
-	${TOP_LIBDIR}/libsys.a
+	${TOP_LIBDIR}/libsys.a -lresolv
 
 
 all: ukinstall ptserver pts pt_util db_verify ${TOP_LIBDIR}/libprot.a ${TOP_INCDIR}/afs/prclient.h ${TOP_INCDIR}/afs/prerror.h ${TOP_INCDIR}/afs/print.h ${TOP_INCDIR}/afs/prserver.h ${TOP_INCDIR}/afs/ptclient.h ${TOP_INCDIR}/afs/pterror.h ${TOP_INCDIR}/afs/ptint.h ${TOP_INCDIR}/afs/ptserver.h readgroup readpwd testpt
--- openafs-1.2.11/./src/scout/Makefile.in	2001-09-08 02:30:25.000000000 +0200
+++ openafs-1.2.11-su/./src/scout/Makefile.in	2004-06-02 02:47:49.000000000 +0200
@@ -67,7 +67,7 @@
 	${TOP_LIBDIR}/libaudit.a \
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/liblwp.a \
-	${TOP_LIBDIR}/util.a
+	${TOP_LIBDIR}/util.a -lresolv
 
 all: scout
 
--- openafs-1.2.11/./src/tbutc/Makefile.in	2002-07-26 07:00:27.000000000 +0200
+++ openafs-1.2.11-su/./src/tbutc/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -84,7 +84,7 @@
 	    ${TOP_LIBDIR}/util.a \
 	    ${TOP_LIBDIR}/libusd.a \
 	    ${TOP_LIBDIR}/libprocmgmt.a \
-	    ${TOP_LIBDIR}/librx.a
+	    ${TOP_LIBDIR}/librx.a -lresolv
 
 #
 # Build targets
--- openafs-1.2.11/./src/tviced/Makefile.in	2003-10-24 07:25:14.000000000 +0200
+++ openafs-1.2.11-su/./src/tviced/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -65,7 +65,7 @@
 objects= ${VICEDOBJS} ${VLSERVEROBJS} ${LWPOBJS} ${LIBACLOBJS} \
 	 ${UTILOBJS} ${DIROBJS} ${VOLOBJS} ${FSINTOBJS}
 
-LIBS=${TOP_LIBDIR}/libafsauthent.a ${TOP_LIBDIR}/libafsrpc.a ${TOP_LIBDIR}/util.a
+LIBS=${TOP_LIBDIR}/libafsauthent.a ${TOP_LIBDIR}/libafsrpc.a ${TOP_LIBDIR}/util.a -lresolv
 
 all: fileserver
 
--- openafs-1.2.11/./src/update/Makefile.in	2001-09-08 01:36:03.000000000 +0200
+++ openafs-1.2.11-su/./src/update/Makefile.in	2004-06-02 02:49:49.000000000 +0200
@@ -34,7 +34,7 @@
 	${TOP_LIBDIR}/liblwp.a \
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/util.a \
-	${TOP_LIBDIR}/libsys.a
+	${TOP_LIBDIR}/libsys.a -lresolv
 
 CFLAGS=-I${TOP_INCDIR} -I${TOP_SRCDIR}/config ${XCFLAGS}
 
--- openafs-1.2.11/./src/uss/Makefile.in	2003-07-01 21:10:14.000000000 +0200
+++ openafs-1.2.11-su/./src/uss/Makefile.in	2004-06-02 02:48:13.000000000 +0200
@@ -53,7 +53,7 @@
 	${TOP_LIBDIR}/libcmd.a \
 	${TOP_LIBDIR}/libcom_err.a\
 	${TOP_LIBDIR}/util.a \
-	${XLIBS}
+	${XLIBS} -lresolv
 
 OBJS =  uss_procs.o \
 	uss_common.o \
--- openafs-1.2.11/./src/venus/Makefile.in	2003-07-01 21:04:15.000000000 +0200
+++ openafs-1.2.11-su/./src/venus/Makefile.in	2004-06-02 02:49:19.000000000 +0200
@@ -54,7 +54,7 @@
 	 ${TOP_LIBDIR}/libsys.a \
 	 $(TOP_LIBDIR)/util.a \
 	 ${TOP_LIBDIR}/liblwp.a \
-	 ${TOP_LIBDIR}/libaudit.a
+	 ${TOP_LIBDIR}/libaudit.a -lresolv
 
 CMLIBS=${TOP_LIBDIR}/libsys.a \
 	 ${TOP_LIBDIR}/libafsint.a \
@@ -65,7 +65,7 @@
 	 ${TOP_LIBDIR}/librx.a \
 	 ${TOP_LIBDIR}/libsys.a \
 	 $(TOP_LIBDIR)/util.a \
-	 ${TOP_LIBDIR}/liblwp.a
+	 ${TOP_LIBDIR}/liblwp.a -lresolv
 
 LIBS = ${FSLIBS} 
 
--- openafs-1.2.11/./src/viced/Makefile.in	2003-10-24 07:25:18.000000000 +0200
+++ openafs-1.2.11-su/./src/viced/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -52,7 +52,7 @@
 	${TOP_LIBDIR}/libdes.a		\
 	${TOP_LIBDIR}/libcom_err.a	\
 	${TOP_LIBDIR}/util.a		\
-	${TOP_LIBDIR}/liblwp.a
+	${TOP_LIBDIR}/liblwp.a -lresolv
 
 headers=${TOP_INCDIR}/lwp.h		\
 	${TOP_INCDIR}/afs/acl.h	\
--- openafs-1.2.11/./src/vlserver/Makefile.in	2003-07-07 22:16:48.000000000 +0200
+++ openafs-1.2.11-su/./src/vlserver/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -51,7 +51,7 @@
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/util.a \
 	${TOP_LIBDIR}/libsys.a \
-	${TOP_LIBDIR}/util.a
+	${TOP_LIBDIR}/util.a -lresolv
 
 auditlib=${TOP_LIBDIR}/libaudit.a
 
--- openafs-1.2.11/./src/volser/Makefile.in	2001-09-10 22:21:13.000000000 +0200
+++ openafs-1.2.11-su/./src/volser/Makefile.in	2004-06-02 02:12:42.000000000 +0200
@@ -62,7 +62,7 @@
 	${TOP_LIBDIR}/libcom_err.a \
 	${TOP_LIBDIR}/libkauth.a \
 	${TOP_LIBDIR}/libusd.a \
-	${TOP_LIBDIR}/util.a
+	${TOP_LIBDIR}/util.a -lresolv
 
 VSOBJS=vsprocs.o vsutils.o lockprocs.o volint.xdr.o volerr.o 
 SOBJS=volmain.o volprocs.o physio.o common.o voltrans.o volerr.o \
--- openafs-1.2.11/src/libuafs/MakefileProto.LINUX.in	2001-09-08 01:35:24.000000000 +0200
+++ openafs-1.2.11-su/src/libuafs/MakefileProto.LINUX.in	2004-06-02 02:44:30.000000000 +0200
@@ -37,7 +37,7 @@
 
 TEST_CFLAGS=-pthread -D_REENTRANT -DAFS_PTHREAD_ENV -DAFS_LINUX22_ENV
 TEST_LDFLAGS=
-TEST_LIBS=-lpthread
+TEST_LIBS=-lpthread -lresolv
 
 LIBUAFS = libuafs.a
 LIBAFSWEB = nsafs.so
