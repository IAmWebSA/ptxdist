#
# rules/kernel.in
#

# 
# FIXME / TODO: 
#
# select HOST_MODUTILS for 2.4 kernels
# select HOST_MODULE_INIT_TOOLS for 2.6 kernels
#

##############################################################################
menu "Kernel              "
##############################################################################

comment "----------------------------------"
comment "Target Kernel"
comment "----------------------------------"

config KERNEL_TARGET_VERSION 
	prompt "Target Kernel Version"
	string
	default "2.6.15"

config KERNEL_TARGET_SERIES
	prompt "Patch Series File"
	string
	default "series"
	help
	  This entry specifies a patch series file which has to live in
	  this directory: 

		$PTXDIST_WORKSPACE/kernel-patches-target

	  The series file contains lines with names of patch files which
	  are then being applied to the kernel.  

config KERNEL_TARGET_COMPILE
	bool
	prompt "Compile Target Kernel"
	depends on BUILD_USERLAND
	help
	  Usually you want to compile your kernel. If not,
	  deselect this option. 

# ----------------------------------------------------------------------------

comment "Target Kernel Options"
	depends on BUILD_USERLAND

choice
	prompt "Image Type"
	default KERNEL_TARGET_IMAGE_BZ
	depends on KERNEL_TARGET_COMPILE

config KERNEL_TARGET_IMAGE_BZ
	bool
	prompt "bzImage"
	
config KERNEL_TARGET_IMAGE_Z
	bool
	prompt "zImage"

config KERNEL_TARGET_IMAGE_U
	bool
	prompt "uImage"
	select HOST_UMKIMAGE

config KERNEL_TARGET_IMAGE_VMLINUX
	bool
	prompt "vmlinux"
endchoice

config KERNEL_TARGET_EXTERNAL
	bool
	prompt "External Kernel"
	depends on BUILD_USERLAND
	help
	  Say yes if you intend to use an external already configured 
	  kernel tree. You want this if you, for example, are currently
	  working in a kernel tree and don't want to generate patches 
	  for each and every PTXdist run. 

config KERNEL_EXTERNAL_DIR
	string
	prompt "Path to external kernel source"
	depends on KERNEL_TARGET_EXTERNAL
	help
	  Add a path to your external kernel here. The kernel must be
	  configured. 

config KERNEL_TARGET_INSTALL
	bool
	depends on BUILD_USERLAND
	prompt "Install kernel into /boot on target"
	select KERNEL_TARGET_INSTALL_MODULES if KERNEL_TARGET_COMPILE

config KERNEL_TARGET_INSTALL_MODULES
	bool
	depends on BUILD_USERLAND
	prompt "Install modules into /lib/modules on target"

# ----------------------------------------------------------------------------

comment "----------------------------------"
depends on BUILD_USERLAND
comment "Native Kernel (Simulation)"
depends on BUILD_USERLAND
comment "----------------------------------"
depends on BUILD_USERLAND

config KERNEL_NATIVE_VERSION 
	prompt "Native Kernel Version"
	string
	depends on BUILD_USERLAND
	default "2.6.15"

config KERNEL_NATIVE_SERIES
	prompt "Patch Series File"
	string
	default "series"
	depends on BUILD_USERLAND
	help
	  This entry specifies a patch series file which has to live in
	  this directory: 

		$PTXDIST_WORKSPACE/kernel-patches-native

	  The series file contains lines with names of patch files which
	  are then being applied to the kernel.  

config KERNEL_NATIVE_COMPILE
	bool
	prompt "Compile Native Kernel"
	depends on BUILD_USERLAND
	default Y
	help
	  FIXME

# ----------------------------------------------------------------------------

comment "Native Kernel Options"

choice
	prompt "Image Type"
	default KERNEL_NATIVE_IMAGE_BZ
	depends on KERNEL_NATIVE_COMPILE

config KERNEL_NATIVE_IMAGE_BZ
	bool
	prompt "bzImage"
	
config KERNEL_NATIVE_IMAGE_Z
	bool
	prompt "zImage"

config KERNEL_NATIVE_IMAGE_U
	bool
	prompt "uImage"

config KERNEL_NATIVE_IMAGE_VMLINUX
	bool
	prompt "vmlinux"
	select HOST_UMKIMAGE
endchoice


choice
	prompt "Root Filesystem Method"
	depends on KERNEL_NATIVE_COMPILE
		
	config KERNEL_NATIVE_ROOT_HOSTFS
		bool
		prompt "hostfs"
		help
		  Using the hostfs method, $(ROOTDIR) is shared between
		  the host and the user mode linux machine.

endchoice

config KERNEL_NATIVE_CONSOLE_STDSERIAL
	bool
	prompt "map /dev/ttyS0 to stdio"
	depends on KERNEL_NATIVE_COMPILE
	help
	  This switch adds "ssl0=fd:0,fd:1" to the kernel command line,
	  which forwards /dev/ttyS0 of the user mode linux vm to the
	  host's stdin/stdout. 

config KERNEL_NATIVE_CMDLINE
	string
	prompt "kernel command line"
	depends on KERNEL_NATIVE_COMPILE
	help
	  Add your custom kernel commandline for the user mode linux 
	  kernel here. 

endmenu

