#
# rules/klibc.in
#

menuconfig KLIBC
	depends on KERNEL_COMPILE
	bool
	prompt "klibc               "
	depends on BUILD_USERLAND
	help
	  This feature contains a collection of programs that are linked against
	  klibc. These duplicate some of the functionality of a regular Linux
	  toolset, but are typically much smaller than their full-function
	  counterparts. They are intended for inclusion in initramfs images and
	  can do the network configuration outside the kernel and someting
	  special before mounting the final root filesystem.
	  This will create a control file only at
	     ${PTXDIST_WORKSPACE}/build-target/$(KLIBC_DIR)/initramfs_spec
	  The real initramfs will be built by the kernel itself from this control
	  file. So in order to use this feature you have to enter this control
	  filename into the kernel feature -> initramfs entry field.
	  When you enter the name as showing above you will be path and
	  version independend.

#
# statically linked part
#
comment "Select components to install"
	depends on KLIBC

config KLIBC_KINIT
	depends on KLIBC
	bool
	prompt "kinit"
	default y
	help
	  It will be installed into /bin/kinit and is intended to configure the network
	  and mounting NFS based filesystems. It will be controlled by the standard kernel
	  command line, anything else in /arch.cmd and anything else after a -- parameter.
	  All three parts gets combined into one parameter list and will be used for
	  configuration.

config KLIBC_SH
	depends on KLIBC
	bool
	prompt "sh"
	help
	  FIXME: This item needs to be documented

config KLIBC_STATIC_CAT
	depends on KLIBC && !BB_CONFIG_CAT
	bool
	prompt "cat"
	help
	  This is a statically linked "cat" command. It gets installed into /bin/cat

comment "busy box' cat is selected!"
        depends on BB_CONFIG_CAT && KLIBC

config KLIBC_STATIC_CHROOT
	depends on KLIBC && !BB_CONFIG_CHROOT
	bool
	prompt "chroot"
	help
	  This is a statically linked "chroot" command. It gets installed into /bin/chroot

comment "busy box' chroot is selected!"
	depends on BB_CONFIG_CHROOT && KLIBC


config KLIBC_STATIC_DD
	depends on KLIBC && !BB_CONFIG_DD
	bool
	prompt "dd"
	help
	  This is a statically linked "dd" command. It gets installed into /bin/dd

comment "busy box' dd is selected!"
	depends on BB_CONFIG_DD && KLIBC

config KLIBC_STATIC_FALSE
	depends on KLIBC && !BB_CONFIG_FALSE
	bool
	prompt "false"
	help
	  This is a statically linked "false" command. It gets installed into /bin/false

comment "busy box' false is selected!"
	depends on BB_CONFIG_FALSE && KLIBC

config KLIBC_STATIC_INSMOD
	depends on KLIBC && !BB_CONFIG_INSMOD
	bool
	prompt "insmod"
	help
	  This is a statically linked "insmod" command. It gets installed into /bin/insmod

comment "busy box' insmod is selected!"
	depends on BB_CONFIG_INSMOD && KLIBC

config KLIBC_STATIC_LN
	depends on KLIBC && !BB_CONFIG_LN
	bool
	prompt "ln"
	help
	  This is a statically linked "ln" command. It gets installed into /bin/ln

comment "busy box' ln is selected!"
	depends on BB_CONFIG_LN && KLIBC

config KLIBC_STATIC_MINIPS
	depends on KLIBC
	bool
	prompt "minips"
	help
	  This is a statically linked "minips" command. It gets installed into /bin/minips

config KLIBC_STATIC_MKDIR
	depends on KLIBC && !BB_CONFIG_MKDIR
	bool
	prompt "mkdir"
	help
	  This is a statically linked "mkdir" command. It gets installed into /bin/mkdir

comment "busy box' mkdir is selected!"
	depends on BB_CONFIG_MKDIR && KLIBC

config KLIBC_STATIC_MKFIFO
	depends on KLIBC && !BB_CONFIG_MKFIFO
	bool
	prompt "mkfifo"
	help
	  This is a statically linked "mkfifo" command. It gets installed into /bin/mkfifo

comment "busy box' mkfifo is selected!"
	depends on BB_CONFIG_MKFIFO && KLIBC

config KLIBC_STATIC_MOUNT
	depends on KLIBC && !BB_CONFIG_MOUNT
	bool
	prompt "mount"
	help
	  This is a statically linked "mount" command. It gets installed into /bin/mount

comment "busy box' mount is selected!"
	depends on BB_CONFIG_MOUNT && KLIBC

config KLIBC_STATIC_NUKE
	depends on KLIBC
	bool
	prompt "nuke"
	help
	  This is a statically linked "nuke" command. It gets installed into /bin/nuke

config KLIBC_STATIC_PIVOT_ROOT
	depends on KLIBC
	bool
	prompt "pivot-root"
	help
	  This is a statically linked "pivot_root" command. It gets installed into /bin/pivot_root

config KLIBC_STATIC_SLEEP
	depends on KLIBC && !BB_CONFIG_SLEEP
	bool
	prompt "sleep"
	help
	  This is a statically linked "sleep" command. It gets installed into /bin/sleep

comment "busy box' sleep is selected!"
	depends on BB_CONFIG_SLEEP && KLIBC

config KLIBC_STATIC_TRUE
	depends on KLIBC && !BB_CONFIG_TRUE
	bool
	prompt "true"
	help
	  This is a statically linked "true" command. It gets installed into /bin/true

comment "busy box' true is selected!"
	depends on BB_CONFIG_TRUE && KLIBC

config KLIBC_STATIC_UMOUNT
	depends on KLIBC && !BB_CONFIG_UMOUNT
	bool
	prompt "umount"
	help
	  This is a statically linked "umount" command. It gets installed into /bin/umount

comment "busy box' umount is selected!"
	depends on BB_CONFIG_UMOUNT && KLIBC

config KLIBC_STATIC_UNAME
	depends on KLIBC && !BB_CONFIG_UNAME
	bool
	prompt "uname"
	help
	  This is a statically linked "uname" command. It gets installed into /bin/uname

comment "busy box' uname is selected!"
	depends on BB_CONFIG_UNAME && KLIBC

#
# dynamic part
#
config KLIBC_DYNAMIC_LIB
	depends on KLIBC
	bool
	prompt "Shared library support"
	help
	  This adds the shared klibc.so to be used for dynamically linked commands. Its the
	  regular way to get smaller executables. It gets installed into /lib/klibc.so

#comment "Select shared linked commands to install"
#	depends on KLIBC
#	depends on KLIBC_DYNAMIC_LIB

######
comment "Static cat command is selected!"
	depends on KLIBC_STATIC_CAT && KLIBC_DYNAMIC_LIB

comment "busy box' cat is selected!"
	depends on !KLIBC_STATIC_CAT && BB_CONFIG_CAT && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_CAT
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_CAT && !BB_CONFIG_CAT
	bool
	prompt "cat"
	help
	  This is a shared "cat" command. It gets installed into /bin/cat

######
comment "Static chroot command is selected!"
	depends on KLIBC_STATIC_CHROOT && KLIBC_DYNAMIC_LIB

comment "busy box' chroot is selected!"
	depends on !KLIBC_STATIC_CHROOT && BB_CONFIG_CHROOT && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_CHROOT
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_CHROOT && !BB_CONFIG_CHROOT
	bool
	prompt "chroot"
	help
	  This is a shared "chroot" command. It gets installed into /bin/chroot

######
comment "Static dd command is selected!"
	depends on KLIBC_STATIC_DD && KLIBC_DYNAMIC_LIB

comment "busy box' dd is selected!"
	depends on !KLIBC_STATIC_DD && BB_CONFIG_DD && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_DD
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_DD && !BB_CONFIG_DD
	bool
	prompt "dd"
	help
	  This is a shared "dd" command. It gets installed into /bin/dd

######
comment "Static false command is selected!"
	depends on KLIBC_STATIC_FALSE && KLIBC_DYNAMIC_LIB

comment "busy box' false is selected!"
	depends on !KLIBC_STATIC_FALSE && BB_CONFIG_FALSE && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_FALSE
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_FALSE && !BB_CONFIG_FALSE
	bool
	prompt "false"
	help
	  This is a shared "false" command. It gets installed into /bin/false

######
comment "Static insmod command is selected!"
	depends on KLIBC_STATIC_INSMOD && KLIBC_DYNAMIC_LIB

comment "busy box' insmod is selected!"
	depends on !KLIBC_STATIC_INSMOD && BB_CONFIG_INSMOD && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_INSMOD
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_INSMOD && !BB_CONFIG_INSMOD
	bool
	prompt "insmod"
	help
	  This is a shared "insmod" command. It gets installed into /bin/insmod

######
comment "Static ln command is selected!"
	depends on KLIBC_STATIC_LN && KLIBC_DYNAMIC_LIB

comment "busy box' ln is selected!"
	depends on !KLIBC_STATIC_LN && BB_CONFIG_LN && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_LN
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_LN && !BB_CONFIG_LN
	bool
	prompt "ln"
	help
	  This is a shared "ln" command. It gets installed into /bin/ln

######
comment "Static minips command is selected!"
	depends on KLIBC_STATIC_MINIPS && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_MINIPS
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_MINIPS
	bool
	prompt "minips"
	help
	  This is a shared "minips" command. It gets installed into /bin/minips

######
comment "Static mkdir command is selected!"
	depends on KLIBC_STATIC_MKDIR && KLIBC_DYNAMIC_LIB

comment "busy box' mkdir is selected!"
	depends on !KLIBC_STATIC_MKDIR && BB_CONFIG_MKDIR && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_MKDIR
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_MKDIR && !BB_CONFIG_MKDIR
	bool
	prompt "mkdir"
	help
	  This is a shared "mkdir" command. It gets installed into /bin/mkdir

######
comment "Static mkfifo command is selected!"
	depends on KLIBC_STATIC_MKFIFO && KLIBC_DYNAMIC_LIB

comment "busy box' mkfifo is selected!"
	depends on !KLIBC_STATIC_MKFIFO && BB_CONFIG_MKFIFO && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_MKFIFO
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_MKFIFO && !BB_CONFIG_MKFIFO
	bool
	prompt "mkfifo"
	help
	  This is a shared "mkfifo" command. It gets installed into /bin/mkfifo

######
comment "Static mount command is selected!"
	depends on KLIBC_STATIC_MOUNT && KLIBC_DYNAMIC_LIB

comment "busy box' mount is selected!"
	depends on !KLIBC_STATIC_MOUNT && BB_CONFIG_MOUNT && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_MOUNT
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_MOUNT && !BB_CONFIG_MOUNT
	bool
	prompt "mount"
	help
	  This is a shared "mount" command. It gets installed into /bin/mount

######
comment "Static nuke command is selected!"
	depends on KLIBC_STATIC_NUKE && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_NUKE
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_NUKE
	bool
	prompt "nuke"
	help
	  This is a shared "nuke" command. It gets installed into /bin/nuke

######
comment "Static pivot_root command is selected!"
	depends on KLIBC_STATIC_PIVOT_ROOT && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_PIVOT_ROOT
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_PIVOT_ROOT
	bool
	prompt "pivot_root"
	help
	  This is a shared "pivot_root" command. It gets installed into /bin/pivot_root

######
comment "Static sleep command is selected!"
	depends on KLIBC_STATIC_SLEEP && KLIBC_DYNAMIC_LIB

comment "busy box' sleep is selected!"
	depends on !KLIBC_STATIC_SLEEP && BB_CONFIG_SLEEP && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_SLEEP
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_SLEEP && !BB_CONFIG_SLEEP
	bool
	prompt "sleep"
	help
	  This is a shared "sleep" command. It gets installed into /bin/sleep

######
comment "Static true command is selected!"
	depends on KLIBC_STATIC_TRUE && KLIBC_DYNAMIC_LIB

comment "busy box' true is selected!"
	depends on !KLIBC_STATIC_TRUE && BB_CONFIG_TRUE && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_TRUE
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_TRUE && !BB_CONFIG_TRUE
	bool
	prompt "true"
	help
	  This is a shared "true" command. It gets installed into /bin/true

######
comment "Static umount command is selected!"
	depends on KLIBC_STATIC_UMOUNT && KLIBC_DYNAMIC_LIB

comment "busy box' umount is selected!"
	depends on !KLIBC_STATIC_UMOUNT && BB_CONFIG_UMOUNT && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_UMOUNT
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_UMOUNT && !BB_CONFIG_UMOUNT
	bool
	prompt "umount"
	help
	  This is a shared "umount" command. It gets installed into /bin/umount

######
comment "Static uname command is selected!"
	depends on KLIBC_STATIC_UNAME && KLIBC_DYNAMIC_LIB

comment "busy box' uname is selected!"
	depends on !KLIBC_STATIC_UNAME && BB_CONFIG_UNAME && KLIBC_DYNAMIC_LIB

config KLIBC_SHARED_UNAME
	depends on KLIBC
	depends on KLIBC_DYNAMIC_LIB
	depends on !KLIBC_STATIC_UNAME && !BB_CONFIG_UNAME
	bool
	prompt "uname"
	help
	  This is a shared "uname" command. It gets installed into /bin/uname

config KLIBC_INIT
	depends on KLIBC
	string
	prompt "create a link from /init to the specified program"
	default "/kinit"
	help
	  A kernel will always start /init in the initramfs if not otherwise specified
	  (see kernel parameter "init="). With this link ist possible to start any program
	  you like.

config KLIBC_USER_SPEC
	depends on KLIBC
	bool
	prompt "parse project specific initramfs_spec"
	help
	  parse the spec file which is expected to live in
	  ${PTXDIST_WORKSPACE}/initramfs_spec. The format is the same as
	  described in the kernelsource under

	  Documentation/early-userspace/README.

	  Files described in this file can either have an absolute or a relative path
	  (relative to ${PTXDIST_WORKSPACE}).


###################################################################################






#config KLIBC_FSTYPE
#	depends on KLIBC
#	bool
#	prompt "Install fstype into initramfs"
#	help
#	  FIXME: This item needs to be documented

#config KLIBC_PRINTF
#	depends on KLIBC
#	bool
#	prompt "Install printf into initramfs"
#	help
#	  FIXME: This item needs to be documented

#config KLIBC_RUN_INIT
#	depends on KLIBC
#	bool
#	prompt "Install run-init into initramfs"
#	help
#	  FIXME: This item needs to be documented


#config KLIBC_NFSMOUNT
#	depends on KLIBC
#	bool
#	prompt "Install nfsmount into initramfs"
#	help
#	  FIXME: This item needs to be documented

