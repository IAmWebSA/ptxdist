# $Id: template,v 1.2 2003/06/16 12:05:16 bsp Exp $
#
# (c) 2002 by Pengutronix e.K., Hildesheim, Germany
# See CREDITS for details about who has contributed to this project. 
#
# For further information about the PTXDIST project and license conditions
# see the README file.
#

#
# We provide this package
#
PACKAGES += foo

#
# Paths and names 
#
FOO			= foo-a.b.c
FOO_URL			= ftp://foo.bar.baz/$(FOO).tar.gz
FOO_SOURCE		= $(SRCDIR)/$(FOO).tar.gz
FOO_DIR			= $(BUILDDIR)/$(FOO)
FOO_EXTRACT 		= gzip -dc

# ----------------------------------------------------------------------------
# Get
# ----------------------------------------------------------------------------

foo_get: $(STATEDIR)/foo.get

$(STATEDIR)/foo.get: $(FOO_SOURCE)
	touch $@

$(FOO_SOURCE):
	@$(call targetinfo, foo.get)
	wget -P $(SRCDIR) $(PASSIVEFTP) $(FOO_URL)

# ----------------------------------------------------------------------------
# Extract
# ----------------------------------------------------------------------------

foo_extract: $(STATEDIR)/foo.extract

$(STATEDIR)/foo.extract: $(STATEDIR)/foo.get
	@$(call targetinfo, foo.extract)
	$(FOO_EXTRACT) $(FOO_SOURCE) | $(TAR) -C $(BUILDDIR) -xf -
	touch $@

# ----------------------------------------------------------------------------
# Prepare
# ----------------------------------------------------------------------------

foo_prepare: $(STATEDIR)/foo.prepare

$(STATEDIR)/foo.prepare: $(STATEDIR)/foo.extract
	@$(call targetinfo, foo.prepare)
	cd $(FOO_DIR) && 						\
	CFLAGS=$(CFLAGS) ./configure 					\
		--some-options
	touch $@

# ----------------------------------------------------------------------------
# Compile
# ----------------------------------------------------------------------------

foo_compile: $(STATEDIR)/foo.compile

$(STATEDIR)/foo.compile: $(STATEDIR)/foo.prepare 
	@$(call targetinfo, foo.compile)
	make -C $(FOO_DIR) $(MAKEPARMS)
	touch $@

# ----------------------------------------------------------------------------
# Install
# ----------------------------------------------------------------------------

foo_install: $(STATEDIR)/foo.install

$(STATEDIR)/foo.install: $(STATEDIR)/foo.compile
	@$(call targetinfo, foo.install)
	
	make -C $(FOO_DIR) install
	touch $@

# ----------------------------------------------------------------------------
# Target-Install
# ----------------------------------------------------------------------------

foo_targetinstall: $(STATEDIR)/foo.targetinstall

$(STATEDIR)/foo.targetinstall: $(STATEDIR)/foo.install
	@$(call targetinfo, foo.targetinstall)
	# don't forget to $(CROSSSTRIP) -S your source!
	touch $@

# ----------------------------------------------------------------------------
# Clean
# ----------------------------------------------------------------------------

foo_clean: 
	rm -rf $(STATEDIR)/foo.* $(FOO_DIR)

# vim: syntax=make
