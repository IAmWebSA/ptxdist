# 
# Submitted-By: Sascha Hauer, 2006-02-23
# Committed-By: Sascha Hauer
#
# Error: 
#
# crosscompiling sux, x86 doesn't like it, when arm binaries are executed:
#
# make[3]: Entering directory `/ptx/work/sha/ptxdist/ptxdist-projects/ptxdist-0.10-trunk/local_projects/phyCORE-pcm027/build-target/libXt-X11R7.0-1.0.0/src'
# ../util/makestrs -i ..  < ../util/string.list > StringDefs.c
# /bin/sh: ../util/makestrs: cannot execute binary file
# make[3]: *** [StringDefs.c] Error 126
#
#
# Description: 
#
# build makestrs for build not for host, using BSP hack, but works
#
# State:
# 
# not submitted upstream. This patch is not complete. For a proper
# fix we need to build makestrs twice: once for compiling and once
# for installing. For ptxdist we don't want to install makestrs, so
# don't care for now
#
Index: libXt-X11R7.0-1.0.0/util/Makefile.am
===================================================================
--- libXt-X11R7.0-1.0.0.orig/util/Makefile.am
+++ libXt-X11R7.0-1.0.0/util/Makefile.am
@@ -1,3 +1,11 @@
+# evil hack
+CFLAGS=$(CFLAGS_FOR_BUILD)
+CPPFLAGS=$(CPPFLAGS_FOR_BUILD)
+LDFLAGS=$(LDFLAGS_FOR_BUILD)
+
+CC=$(CC_FOR_BUILD)
+LIBTOOL = @LIBTOOL@ --tag=CC
+
 if INSTALL_MAKESTRS
 bin_PROGRAMS = makestrs
 else
@@ -10,7 +18,9 @@ EXTRA_DIST = \
 	StrDefs.ht \
 	string.list
 
-makestrs_CFLAGS = $(XT_CFLAGS)
+makestrs_CFLAGS=$(CFLAGS_FOR_BUILD)
+makestrs_CPPLAGS=$(CPPFLAGS_FOR_BUILD)
+makestrs_LDFLAGS=$(LDFLAGS_FOR_BUILD)
 makestrs_SOURCES = makestrs.c
 
 
Index: libXt-X11R7.0-1.0.0/util/Makefile.in
===================================================================
--- libXt-X11R7.0-1.0.0.orig/util/Makefile.in
+++ libXt-X11R7.0-1.0.0/util/Makefile.in
@@ -49,11 +49,14 @@ AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
 AWK = @AWK@
-CC = @CC@
+
+CC = $(CC_FOR_BUILD)
 CCDEPMODE = @CCDEPMODE@
-CFLAGS = @CFLAGS@
+
+# evil hack
+CFLAGS = $(CFLAGS_FOR_BUILD)
 CPP = @CPP@
-CPPFLAGS = @CPPFLAGS@
+CPPFLAGS = $(CPPFLAGS_FOR_BUILD)
 CXX = @CXX@
 CXXCPP = @CXXCPP@
 CXXDEPMODE = @CXXDEPMODE@
@@ -79,10 +82,10 @@ INSTALL_MAKESTRS_TRUE = @INSTALL_MAKESTR
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
-LDFLAGS = @LDFLAGS@
+LDFLAGS = $(LDFLAGS_FOR_BUILD)
 LIBOBJS = @LIBOBJS@
 LIBS = @LIBS@
-LIBTOOL = @LIBTOOL@
+LIBTOOL = @LIBTOOL@ --tag=CC
 LIB_MAN_DIR = @LIB_MAN_DIR@
 LIB_MAN_SUFFIX = @LIB_MAN_SUFFIX@
 LN_S = @LN_S@
@@ -158,6 +161,7 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
+
 @INSTALL_MAKESTRS_TRUE@bin_PROGRAMS = makestrs
 @INSTALL_MAKESTRS_FALSE@noinst_PROGRAMS = makestrs
 
@@ -168,7 +172,9 @@ EXTRA_DIST = \
 	string.list\
 $(appman_PRE)
 
-makestrs_CFLAGS = $(XT_CFLAGS)
+makestrs_CFLAGS = $(CFLAGS_FOR_BUILD)
+makestrs_CPPLAGS = $(CPPFLAGS_FOR_BUILD)
+makestrs_LDFLAGS = $(LDFLAGS_FOR_BUILD)
 makestrs_SOURCES = makestrs.c
 
 # Man page
@@ -206,7 +212,6 @@ am_makestrs_OBJECTS = makestrs-makestrs.
 makestrs_OBJECTS = $(am_makestrs_OBJECTS)
 makestrs_LDADD = $(LDADD)
 makestrs_DEPENDENCIES =
-makestrs_LDFLAGS =
 
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
