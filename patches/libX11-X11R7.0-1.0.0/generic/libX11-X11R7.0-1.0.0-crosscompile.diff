#
# Submitted-By: Sascha Hauer, 2006-02-23
# Committed-By: Sascha Hauer
#
# Error:
#
# makekeys gets crosscompiled but is needed for the host
#
# Description:
#
# use Benes *_FOR_BUILD hack
#
# State:
#
# not reported upstream
#

Index: libX11-X11R7.0-1.0.0/src/util/Makefile.am
===================================================================
--- libX11-X11R7.0-1.0.0.orig/src/util/Makefile.am
+++ libX11-X11R7.0-1.0.0/src/util/Makefile.am
@@ -1,10 +1,17 @@
 # $XdotOrg$
 
-noinst_PROGRAMS=makekeys
+# evil hack
+CFLAGS=$(CFLAGS_FOR_BUILD) $(X11_CFLAGS) $(BIGREQS_CFLAGS)
+CPPFLAGS=$(CPPFLAGS_FOR_BUILD)
+LDFLAGS=$(LDFLAGS_FOR_BUILD)
+
+CC=$(CC_FOR_BUILD)
+LIBTOOL = @LIBTOOL@ --tag=CC
 
-makekeys_CFLAGS=$(X11_CFLAGS) $(BIGREQS_CFLAGS)
+noinst_PROGRAMS=makekeys
 
-#override CC = gcc
-LINK = $(CC) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+makekeys_CFLAGS=$(CFLAGS_FOR_BUILD)
+makekeys_CPPLAGS=$(CPPFLAGS_FOR_BUILD)
+makekeys_LDFLAGS=$(LDFLAGS_FOR_BUILD)
 
 EXTRA_DIST = mkks.sh
Index: libX11-X11R7.0-1.0.0/src/util/Makefile.in
===================================================================
--- libX11-X11R7.0-1.0.0.orig/src/util/Makefile.in
+++ libX11-X11R7.0-1.0.0/src/util/Makefile.in
@@ -55,11 +55,14 @@ BIGFONT_CFLAGS = @BIGFONT_CFLAGS@
 BIGFONT_LIBS = @BIGFONT_LIBS@
 BIGREQS_CFLAGS = @BIGREQS_CFLAGS@
 BIGREQS_LIBS = @BIGREQS_LIBS@
-CC = @CC@
+
+CC = $(CC_FOR_BUILD)
 CCDEPMODE = @CCDEPMODE@
-CFLAGS = @CFLAGS@
+
+# evil hack
+CFLAGS = $(CFLAGS_FOR_BUILD) $(X11_CFLAGS) $(BIGREQS_CFLAGS)
 CPP = @CPP@
-CPPFLAGS = @CPPFLAGS@
+CPPFLAGS = $(CPPFLAGS_FOR_BUILD)
 CXX = @CXX@
 CXXCPP = @CXXCPP@
 CXXDEPMODE = @CXXDEPMODE@
@@ -85,10 +88,10 @@ INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
 KEYSYMDEF = @KEYSYMDEF@
-LDFLAGS = @LDFLAGS@
+LDFLAGS = $(LDFLAGS_FOR_BUILD)
 LIBOBJS = @LIBOBJS@
 LIBS = @LIBS@
-LIBTOOL = @LIBTOOL@
+LIBTOOL = @LIBTOOL@ --tag=CC
 LIB_MAN_DIR = @LIB_MAN_DIR@
 LIB_MAN_SUFFIX = @LIB_MAN_SUFFIX@
 LN_S = @LN_S@
@@ -199,10 +202,9 @@ target_alias = @target_alias@
 
 noinst_PROGRAMS = makekeys
 
-makekeys_CFLAGS = $(X11_CFLAGS) $(BIGREQS_CFLAGS)
-
-#override CC = gcc
-LINK = $(CC) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+makekeys_CFLAGS = $(CFLAGS_FOR_BUILD)
+makekeys_CPPLAGS = $(CPPFLAGS_FOR_BUILD)
+makekeys_LDFLAGS = $(LDFLAGS_FOR_BUILD)
 
 EXTRA_DIST = mkks.sh
 subdir = src/util
@@ -218,7 +220,6 @@ makekeys_SOURCES = makekeys.c
 makekeys_OBJECTS = makekeys-makekeys.$(OBJEXT)
 makekeys_LDADD = $(LDADD)
 makekeys_DEPENDENCIES =
-makekeys_LDFLAGS =
 
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)/src -I$(top_builddir)/include/X11
 depcomp = $(SHELL) $(top_srcdir)/depcomp
@@ -229,6 +230,8 @@ COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUD
 LTCOMPILE = $(LIBTOOL) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) \
 	$(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
+LINK = $(LIBTOOL) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 DIST_SOURCES = makekeys.c
 DIST_COMMON = $(srcdir)/Makefile.in Makefile.am
 SOURCES = makekeys.c
