From: Han Sirkstra <han@protonic.nl>
Date: Wed, 2 Sep 2015 12:49:53 +0200
Subject: [PATCH] python3: don't leak host path into cross compilation

Signed-off-by: David Jander <david@protonic.nl>
---
 Lib/distutils/command/build_ext.py | 2 +-
 setup.py                           | 3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/Lib/distutils/command/build_ext.py b/Lib/distutils/command/build_ext.py
index 3ab2d04bf98a..acbe648036fc 100644
--- a/Lib/distutils/command/build_ext.py
+++ b/Lib/distutils/command/build_ext.py
@@ -237,7 +237,7 @@ class build_ext(Command):
         # Python's library directory must be appended to library_dirs
         # See Issues: #1600860, #4366
         if (sysconfig.get_config_var('Py_ENABLE_SHARED')):
-            if sys.executable.startswith(os.path.join(sys.exec_prefix, "bin")):
+            if not sysconfig.python_build:
                 # building third party extensions
                 self.library_dirs.append(sysconfig.get_config_var('LIBDIR'))
             else:
diff --git a/setup.py b/setup.py
index 5d4f44465a8a..c37cb33b2f12 100644
--- a/setup.py
+++ b/setup.py
@@ -493,7 +493,8 @@ class PyBuildExt(build_ext):
                         add_dir_to_list(dir_list, directory)
 
         if os.path.normpath(sys.base_prefix) != '/usr' \
-                and not sysconfig.get_config_var('PYTHONFRAMEWORK'):
+                and not sysconfig.get_config_var('PYTHONFRAMEWORK') \
+                and not cross_compiling:
             # OSX note: Don't add LIBDIR and INCLUDEDIR to building a framework
             # (PYTHONFRAMEWORK is set) to avoid # linking problems when
             # building a framework with different architectures than
