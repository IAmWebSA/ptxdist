From: Wayne Davison <wayned@samba.org>
Date: Mon, 17 Dec 2007 01:18:01 +0000 (-0800)
Subject: Only ignore ENOSYS error from lutimes().
X-Git-Url: http://git.samba.org/?p=rsync.git;a=commitdiff_plain;h=77d4c400c200e11aa1ab814101678c02c2d90414

Only ignore ENOSYS error from lutimes().
---

diff --git a/util.c b/util.c
index 2544b45..05748b1 100644
--- a/util.c
+++ b/util.c
@@ -147,8 +147,9 @@ int set_modtime(const char *fname, time_t modtime, mode_t mode)
 		t[1].tv_usec = 0;
 # ifdef HAVE_LUTIMES
 		if (S_ISLNK(mode)) {
-			lutimes(fname, t);
-			return 0; /* ignore errors */
+			if (lutimes(fname, t) < 0 && errno != ENOSYS)
+				return -1;
+			return 0;
 		}
 # endif
 		return utimes(fname, t);

