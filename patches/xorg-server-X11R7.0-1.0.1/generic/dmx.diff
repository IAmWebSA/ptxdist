# 
# Submitted-By: Erwin Rol, 2006-02-22
# Committed-By: Erwin Rol
#
# Error:
# 
#make[4]: Entering directory `/home/erwin/projects/annax/devenv/visbox/build-target/xorg-server-X11R7.0-1.0.1/hw/dmx/input'
#if i586-unknown-linux-gnu-gcc -DHAVE_CONFIG_H -I. -I. -I../../../include -I../../../include -I../../../include -I../../../include -I../../../include -I../../../include   -isystem /home/erwin/projects/annax/devenv/visbox/local/i586-unknown-linux-gnu/include -isystem /home/erwin/projects/annax/devenv/visbox/local/i586-unknown-linux-gnu/usr/include -I../../../hw/dmx -I../../../hw/xfree86/common -DHAVE_DMX_CONFIG_H -I/home/erwin/projects/annax/devenv/visbox/local/i586-unknown-linux-gnu/usr/include -I/home/erwin/projects/annax/devenv/visbox/local/i586-unknown-linux-gnu/usr/include/freetype2 -D_BSD_SOURCE -DHAS_FCHOWN -DHAS_STICKY_DIR_BIT -I/home/erwin/projects/annax/devenv/visbox/local/i586-unknown-linux-gnu/usr/include -I/home/erwin/projects/annax/devenv/visbox/local/i586-unknown-linux-gnu/usr/include/freetype2 -I../../../include -I../../../include -I../../../Xext  -I../../../damageext -I../../../xfixes -I../../../Xi -I../../../mi -I../../../miext/shadow  -I../../../miext/damage -I../../../render -I../../../randr -I../../../fb  -g -O2 -MT ChkNotMaskEv.o -MD -MP -MF ".deps/ChkNotMaskEv.Tpo" \
#  -c -o ChkNotMaskEv.o `test -f 'ChkNotMaskEv.c' || echo './'`ChkNotMaskEv.c; \
#then mv -f ".deps/ChkNotMaskEv.Tpo" ".deps/ChkNotMaskEv.Po"; \
#else rm -f ".deps/ChkNotMaskEv.Tpo"; exit 1; \
#fi
#In file included from ChkNotMaskEv.c:63:
#../../../hw/dmx/dmx.h:67:20: GL/glx.h: No such file or directory
#In file included from ../../../hw/dmx/dmx.h:68,
#                 from ChkNotMaskEv.c:63:
#/home/erwin/projects/annax/devenv/visbox/local/i586-unknown-linux-gnu/usr/include/GL/glxint.h:28:19: GL/gl.h: No such file or directory
#In file included from ../../../hw/dmx/dmx.h:68,
#                 from ChkNotMaskEv.c:63:
#
# Description: 
# On the net i found the following patch;
#  http://lists.x.org/archives/xorg-modular/2005-August/000618.html
# It seems that this only happens when build without having the mesa sources "installed"
# because the DMX (unlike the other Xorg parts) tries to find the headers in the system 
# include directories and not in the MESA_SOURCE directory.
#
# State:
# 
# Unknown if the latest Xorg CVS fixes this in one way or another.
#

diff -ru xorg-server-X11R7.0-1.0.1.orig/hw/dmx/config/Makefile.am xorg-server-X11R7.0-1.0.1/hw/dmx/config/Makefile.am
--- xorg-server-X11R7.0-1.0.1.orig/hw/dmx/config/Makefile.am	2005-12-06 23:48:48.000000000 +0100
+++ xorg-server-X11R7.0-1.0.1/hw/dmx/config/Makefile.am	2006-02-22 11:53:06.000000000 +0100
@@ -24,6 +24,7 @@
 AM_CFLAGS = \
 	@SERVER_DEFINES@ \
 	-I$(top_srcdir)/hw/dmx \
+	-I@MESA_SOURCE@/include \
 	-DHAVE_DMX_CONFIG_H \
 	-DDMX_LOG_STANDALONE \
 	@DMXMODULES_CFLAGS@
diff -ru xorg-server-X11R7.0-1.0.1.orig/hw/dmx/config/Makefile.in xorg-server-X11R7.0-1.0.1/hw/dmx/config/Makefile.in
--- xorg-server-X11R7.0-1.0.1.orig/hw/dmx/config/Makefile.in	2005-12-21 08:36:21.000000000 +0100
+++ xorg-server-X11R7.0-1.0.1/hw/dmx/config/Makefile.in	2006-02-22 12:11:29.000000000 +0100
@@ -444,6 +444,7 @@
 AM_CFLAGS = \
 	@SERVER_DEFINES@ \
 	-I$(top_srcdir)/hw/dmx \
+	-I@MESA_SOURCE@/include \
 	-DHAVE_DMX_CONFIG_H \
 	-DDMX_LOG_STANDALONE \
 	@DMXMODULES_CFLAGS@
diff -ru xorg-server-X11R7.0-1.0.1.orig/hw/dmx/input/Makefile.am xorg-server-X11R7.0-1.0.1/hw/dmx/input/Makefile.am
--- xorg-server-X11R7.0-1.0.1.orig/hw/dmx/input/Makefile.am	2005-12-02 07:02:40.000000000 +0100
+++ xorg-server-X11R7.0-1.0.1/hw/dmx/input/Makefile.am	2006-02-22 11:53:06.000000000 +0100
@@ -58,6 +58,7 @@
 AM_CFLAGS = @SERVER_DEFINES@ \
             -I$(top_srcdir)/hw/dmx \
             -I$(top_srcdir)/hw/xfree86/common \
+            -I@MESA_SOURCE@/include \
             -DHAVE_DMX_CONFIG_H \
             @DMXMODULES_CFLAGS@
 
diff -ru xorg-server-X11R7.0-1.0.1.orig/hw/dmx/input/Makefile.in xorg-server-X11R7.0-1.0.1/hw/dmx/input/Makefile.in
--- xorg-server-X11R7.0-1.0.1.orig/hw/dmx/input/Makefile.in	2005-12-21 08:36:22.000000000 +0100
+++ xorg-server-X11R7.0-1.0.1/hw/dmx/input/Makefile.in	2006-02-22 12:12:18.000000000 +0100
@@ -480,6 +480,7 @@
 AM_CFLAGS = @SERVER_DEFINES@ \
             -I$(top_srcdir)/hw/dmx \
             -I$(top_srcdir)/hw/xfree86/common \
+            -I@MESA_SOURCE@/include \
             -DHAVE_DMX_CONFIG_H \
             @DMXMODULES_CFLAGS@
 
diff -ru xorg-server-X11R7.0-1.0.1.orig/hw/dmx/Makefile.am xorg-server-X11R7.0-1.0.1/hw/dmx/Makefile.am
--- xorg-server-X11R7.0-1.0.1.orig/hw/dmx/Makefile.am	2005-12-06 23:48:48.000000000 +0100
+++ xorg-server-X11R7.0-1.0.1/hw/dmx/Makefile.am	2006-02-22 11:53:06.000000000 +0100
@@ -11,7 +11,7 @@
 SUBDIRS += glxProxy
 GLX_LIBS = glxProxy/libglxproxy.a
 GLX_SRCS = $(PANORAMIX_SRCS) dmx_glxvisuals.c dmx_glxvisuals.h
-GLX_INCS = -I$(top_srcdir)/hw/xfree86/dixmods/extmod
+GLX_INCS = -I$(top_srcdir)/hw/xfree86/dixmods/extmod -I@MESA_SOURCE@/include
 endif
 
 if BUILDDOCS
diff -ru xorg-server-X11R7.0-1.0.1.orig/hw/dmx/Makefile.in xorg-server-X11R7.0-1.0.1/hw/dmx/Makefile.in
--- xorg-server-X11R7.0-1.0.1.orig/hw/dmx/Makefile.in	2005-12-21 08:36:21.000000000 +0100
+++ xorg-server-X11R7.0-1.0.1/hw/dmx/Makefile.in	2006-02-22 12:14:14.000000000 +0100
@@ -430,7 +430,7 @@
 @XINERAMA_TRUE@PANORAMIX_SRCS = $(top_srcdir)/Xext/panoramiX.c
 @GLX_TRUE@GLX_LIBS = glxProxy/libglxproxy.a
 @GLX_TRUE@GLX_SRCS = $(PANORAMIX_SRCS) dmx_glxvisuals.c dmx_glxvisuals.h
-@GLX_TRUE@GLX_INCS = -I$(top_srcdir)/hw/xfree86/dixmods/extmod
+@GLX_TRUE@GLX_INCS = -I$(top_srcdir)/hw/xfree86/dixmods/extmod -I@MESA_SOURCE@/include
 
 Xdmx_SOURCES = dmx.c \
                dmxcb.c \
