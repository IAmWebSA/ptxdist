From: Marc Kleine-Budde <mkl@pengutronix.de>
Subject: make LZO support optional

This patch makes the LZO support optional

Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>

---
 Makefile |   13 +++++++++++--
 compr.h  |    2 ++
 2 files changed, 13 insertions(+), 2 deletions(-)

Index: mtd-utils-1.2.0/Makefile
===================================================================
--- mtd-utils-1.2.0.orig/Makefile
+++ mtd-utils-1.2.0/Makefile
@@ -22,6 +22,10 @@ ifeq ($(WITHOUT_XATTR), 1)
   CPPFLAGS += -DWITHOUT_XATTR
 endif
 
+ifeq ($(WITHOUT_LZO), 1)
+  CPPFLAGS += -DWITHOUT_LZO
+endif
+
 RAWTARGETS = ftl_format flash_erase flash_eraseall nanddump doc_loadbios \
 	ftl_check mkfs.jffs2 flash_lock flash_unlock flash_info \
 	flash_otp_info flash_otp_dump mtd_debug flashcp nandwrite nandtest \
@@ -58,14 +62,19 @@ clean:
 $(SYMLINKS):
 	ln -sf ../fs/jffs2/$@ $@
 
+ifneq ($(WITHOUT_LZO), 1)
+JFFS2_COMPR_LZO_O := $(BUILDDIR)/compr_lzo.o
+JFFS2_LIB_LZO := -llzo2
+endif
+
 $(BUILDDIR)/mkfs.jffs2: $(BUILDDIR)/crc32.o \
 			$(BUILDDIR)/compr_rtime.o \
 			$(BUILDDIR)/mkfs.jffs2.o \
 			$(BUILDDIR)/compr_zlib.o \
-			$(BUILDDIR)/compr_lzo.o \
+			$(JFFS2_COMPR_LZO_O) \
 			$(BUILDDIR)/compr.o \
 			$(BUILDDIR)/rbtree.o
-	$(CC) $(LDFLAGS) -o $@ $^ -lz -llzo2
+	$(CC) $(LDFLAGS) -o $@ $^ -lz $(JFFS2_LIB_LZO)
 
 $(BUILDDIR)/flash_eraseall: $(BUILDDIR)/crc32.o $(BUILDDIR)/flash_eraseall.o
 	$(CC) $(LDFLAGS) -o $@ $^
Index: mtd-utils-1.2.0/compr.h
===================================================================
--- mtd-utils-1.2.0.orig/compr.h
+++ mtd-utils-1.2.0/compr.h
@@ -18,7 +18,9 @@
 
 #define CONFIG_JFFS2_ZLIB
 #define CONFIG_JFFS2_RTIME
+#ifndef WITHOUT_LZO
 #define CONFIG_JFFS2_LZO
+#endif
 
 #define JFFS2_RUBINMIPS_PRIORITY 10
 #define JFFS2_DYNRUBIN_PRIORITY  20
