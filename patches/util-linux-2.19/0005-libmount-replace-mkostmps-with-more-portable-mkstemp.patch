From: Karel Zak <kzak@redhat.com>
Date: Fri, 11 Feb 2011 10:18:00 +0100
Subject: [PATCH] libmount: replace mkostmps() with more portable mkstemp()

Reported-by: Peter Breitenlohner <peb@mppmu.mpg.de>
Signed-off-by: Karel Zak <kzak@redhat.com>
---
 shlibs/mount/src/mountP.h     |    2 +-
 shlibs/mount/src/tab_update.c |    2 +-
 shlibs/mount/src/utils.c      |    4 ++--
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/shlibs/mount/src/mountP.h b/shlibs/mount/src/mountP.h
index aeceb7f..71314a5 100644
--- a/shlibs/mount/src/mountP.h
+++ b/shlibs/mount/src/mountP.h
@@ -118,7 +118,7 @@ extern int mnt_in_group(gid_t gid);
 
 extern char *mnt_get_mountpoint(const char *path);
 extern char *mnt_get_fs_root(const char *path, const char *mountpoint);
-extern int mnt_open_uniq_filename(const char *filename, char **name, int flags);
+extern int mnt_open_uniq_filename(const char *filename, char **name);
 extern int mnt_has_regular_utab(const char **utab, int *writable);
 extern const char *mnt_get_utab_path(void);
 
diff --git a/shlibs/mount/src/tab_update.c b/shlibs/mount/src/tab_update.c
index a0f99f1..6b7b4be 100644
--- a/shlibs/mount/src/tab_update.c
+++ b/shlibs/mount/src/tab_update.c
@@ -561,7 +561,7 @@ static int update_table(struct libmnt_update *upd, struct libmnt_table *tb)
 
 	DBG(UPDATE, mnt_debug_h(upd, "%s: updating", upd->filename));
 
-	fd = mnt_open_uniq_filename(upd->filename, &uq, O_WRONLY);
+	fd = mnt_open_uniq_filename(upd->filename, &uq);
 	if (fd < 0)
 		return fd;	/* error */
 
diff --git a/shlibs/mount/src/utils.c b/shlibs/mount/src/utils.c
index cb0ed1c..b02b6fe 100644
--- a/shlibs/mount/src/utils.c
+++ b/shlibs/mount/src/utils.c
@@ -642,7 +642,7 @@ const char *mnt_get_utab_path(void)
 
 /* returns file descriptor or -errno, @name returns uniques filename
  */
-int mnt_open_uniq_filename(const char *filename, char **name, int flags)
+int mnt_open_uniq_filename(const char *filename, char **name)
 {
 	int rc, fd;
 	char *n;
@@ -656,7 +656,7 @@ int mnt_open_uniq_filename(const char *filename, char **name, int flags)
 	if (rc <= 0)
 		return -errno;
 
-	fd = mkostemp(n, flags | O_EXCL);
+	fd = mkstemp(n);
 	if (fd >= 0 && name)
 		*name = n;
 	else
-- 
1.7.0.4

