#
# Submitted-By: Sascha Hauer, 2006-02-23
# Committed-By: Sascha Hauer
#
# Error:
#
# makekeys gets crosscompiled but is needed for the host
#
# Description:
#
# use Benes *_FOR_BUILD hack
#
# rediffed for X.org7.1 by Luotao Fu, 2006-06-19
# State:
#
# not reported upstream
#
# This patch is broken: it should use CC_FOR_BUILD only if
# crosscompiling; at the moment it breaks if CC_FOR_BUILD is not set and
# we build for the host. See nfsutils for an example how to solve it
# correctly. (MKL, RSC)
#

diff -r -u libX11-X11R7.1-1.0.1.orig/src/util/Makefile.am libX11-X11R7.1-1.0.1/src/util/Makefile.am
--- libX11-X11R7.1-1.0.1.orig/src/util/Makefile.am	2006-06-14 13:33:44.152294000 +0200
+++ libX11-X11R7.1-1.0.1/src/util/Makefile.am	2006-06-14 14:42:17.598756893 +0200
@@ -1,10 +1,17 @@
 # $XdotOrg: lib/X11/src/util/Makefile.am,v 1.4 2006-02-19 02:14:12 jamey Exp $
 
-noinst_PROGRAMS=makekeys
+# evil hack
+CFLAGS=$(CFLAGS_FOR_BUILD) $(X11_CFLAGS) $(BIGREQS_CFLAGS)
+CPPFLAGS=$(CPPFLAGS_FOR_BUILD)
+LDFLAGS=$(LDFLAGS_FOR_BUILD)
+
+CC=$(CC_FOR_BUILD)
+LIBTOOL = @LIBTOOL@ --tag=CC
 
-makekeys_CFLAGS=$(X11_CFLAGS)
+noinst_PROGRAMS=makekeys
 
-#override CC = gcc
-LINK = $(CC) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+makekeys_CFLAGS=$(CFLAGS_FOR_BUILD)
+makekeys_CPPLAGS=$(CPPFLAGS_FOR_BUILD)
+makekeys_LDFLAGS=$(LDFLAGS_FOR_BUILD)
 
 EXTRA_DIST = mkks.sh
diff -r -u libX11-X11R7.1-1.0.1.orig/src/util/Makefile.in libX11-X11R7.1-1.0.1/src/util/Makefile.in
--- libX11-X11R7.1-1.0.1.orig/src/util/Makefile.in	2006-06-14 13:33:44.154295000 +0200
+++ libX11-X11R7.1-1.0.1/src/util/Makefile.in	2006-06-14 14:54:12.436541319 +0200
@@ -63,6 +63,8 @@
 	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
+LINK = $(LIBTOOL) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+
 SOURCES = makekeys.c
 DIST_SOURCES = makekeys.c
 ETAGS = etags
@@ -83,11 +85,12 @@
 AWK = @AWK@
 BIGFONT_CFLAGS = @BIGFONT_CFLAGS@
 BIGFONT_LIBS = @BIGFONT_LIBS@
-CC = @CC@
+CC = $(CC_FOR_BUILD)
 CCDEPMODE = @CCDEPMODE@
-CFLAGS = @CFLAGS@
+# evil hack
+CFLAGS = $(CFLAGS_FOR_BUILD) $(X11_CFLAGS) $(BIGREQS_CFLAGS)
 CPP = @CPP@
-CPPFLAGS = @CPPFLAGS@
+CPPFLAGS = $(CPPFLAGS_FOR_BUILD)
 CXX = @CXX@
 CXXCPP = @CXXCPP@
 CXXDEPMODE = @CXXDEPMODE@
@@ -227,7 +230,9 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-makekeys_CFLAGS = $(X11_CFLAGS)
+makekeys_CFLAGS = $(CFLAGS_FOR_BUILD)
+makekeys_CPPLAGS = $(CPPFLAGS_FOR_BUILD)
+makekeys_LDFLAGS = $(LDFLAGS_FOR_BUILD)
 
 #override CC = gcc
 LINK = $(CC) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
@@ -306,14 +311,14 @@
 @am__fastdepCC_FALSE@	$(LTCOMPILE) -c -o $@ $<
 
 makekeys-makekeys.o: makekeys.c
-@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(makekeys_CFLAGS) $(CFLAGS) -MT makekeys-makekeys.o -MD -MP -MF "$(DEPDIR)/makekeys-makekeys.Tpo" -c -o makekeys-makekeys.o `test -f 'makekeys.c' || echo '$(srcdir)/'`makekeys.c; \
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(makekeys_CPPFLAGS) $(makekeys_CFLAGS) $(CFLAGS) -MT makekeys-makekeys.o -MD -MP -MF "$(DEPDIR)/makekeys-makekeys.Tpo" -c -o makekeys-makekeys.o `test -f 'makekeys.c' || echo '$(srcdir)/'`makekeys.c; \
 @am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/makekeys-makekeys.Tpo" "$(DEPDIR)/makekeys-makekeys.Po"; else rm -f "$(DEPDIR)/makekeys-makekeys.Tpo"; exit 1; fi
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	source='makekeys.c' object='makekeys-makekeys.o' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(makekeys_CFLAGS) $(CFLAGS) -c -o makekeys-makekeys.o `test -f 'makekeys.c' || echo '$(srcdir)/'`makekeys.c
 
 makekeys-makekeys.obj: makekeys.c
-@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(makekeys_CFLAGS) $(CFLAGS) -MT makekeys-makekeys.obj -MD -MP -MF "$(DEPDIR)/makekeys-makekeys.Tpo" -c -o makekeys-makekeys.obj `if test -f 'makekeys.c'; then $(CYGPATH_W) 'makekeys.c'; else $(CYGPATH_W) '$(srcdir)/makekeys.c'; fi`; \
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(makekeys_CPPFLAGS) $(makekeys_CFLAGS) $(CFLAGS) -MT makekeys-makekeys.obj -MD -MP -MF "$(DEPDIR)/makekeys-makekeys.Tpo" -c -o makekeys-makekeys.obj `if test -f 'makekeys.c'; then $(CYGPATH_W) 'makekeys.c'; else $(CYGPATH_W) '$(srcdir)/makekeys.c'; fi`; \
 @am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/makekeys-makekeys.Tpo" "$(DEPDIR)/makekeys-makekeys.Po"; else rm -f "$(DEPDIR)/makekeys-makekeys.Tpo"; exit 1; fi
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	source='makekeys.c' object='makekeys-makekeys.obj' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
