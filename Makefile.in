prefix=@PREFIX@
topdir=@TOPDIR@
instdir=@INSTDIR@
version=@VERSION@

all:
	@echo "building lxdialog..."
	cp ${topdir}/scripts/ptx-modifications/Makefile.lxdialog.ptx ${topdir}/scripts/lxdialog/Makefile
	cd ${topdir}/scripts/lxdialog && make
	@echo "building conf..."
	cd ${topdir}/scripts/kconfig && make conf
	@echo "building mconf..."
	cd ${topdir}/scripts/kconfig && make mconf
	@echo "done."
	@touch .done

install: all 
	@echo "installing PTXdist to ${prefix}..."
	@rm -fr ${instdir}
	@mkdir -p ${instdir}
	@test -d ${instdir} || exit 1
	@touch ${instdir} || exit 1 
	@echo "installing PTXdist to ${prefix}/bin..."
	tar -C ${topdir} -cf - --exclude .svn --exclude state . | tar -C ${instdir} -xvf -
	@mkdir -p ${prefix}/bin
	@rm -f ${prefix}/bin/ptxdist
	@ln -sf ${instdir}/bin/ptxdist ${prefix}/bin/ptxdist-${version}
	@ln -sf ${instdir}/bin/ptxdist ${prefix}/bin/ptxdist

clean:
	rm -f Makefile
	rm -f scripts/lxdialog/lxdialog
	rm -f scripts/lxdialog/Makefile
	rm -f scripts/kconfig/conf
	rm -f scripts/kconfig/zconf.tab.c
	rm -f scripts/kconfig/lex.zconf.c
	rm -f scripts/kconfig/lex.backup
	rm -f scripts/kconfig/lkc_defs.h
	rm -f scripts/kconfig/mconf
	rm -f .done

distclean: clean

