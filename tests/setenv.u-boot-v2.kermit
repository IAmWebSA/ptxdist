
# ! gen_uboot_v2_image

#Execute commands
ptx_test_start "Setting environment"
ptx_uboot_exec 3 "eth0.ipaddr=\m(PTXCONF_BOARDSETUP_TARGETIP)" 
ptx_uboot_exec 3 "eth0.serverip=\m(PTXCONF_BOARDSETUP_SERVERIP)"
ptx_uboot_exec 3 "eth0.gateway=\m(PTXCONF_BOARDSETUP_GATEWAY)"
ptx_uboot_exec 3 "eth0.netmask=\m(PTXCONF_BOARDSETUP_NETMASK)"
ptx_uboot_exec 3 "mtdparts=\"128k(uboot)ro,128k(ubootenv),128k(ageing),1280k(kernel0),1280k(kernel1),8704k(system0),8704k(system1),8320k(application),4096k(persistent)\""
ptx_uboot_exec 3 "addpart /dev/nor0 $mtdparts"
ptx_test_end

ptx_uboot_exec_single "Calling server" "ping $eth0.serverip"

ptx_test_start "Flashing environment"
ptx_uboot_exec 3  "unprotect /dev/nor0.ubootenv"
ptx_uboot_exec 10 "erase /dev/nor0.ubootenv"
ptx_uboot_exec 20 "tftp \%1 /dev/nor0.ubootenv"
ptx_uboot_exec 3  "protect /dev/nor0.ubootenv"
ptx_test_end

ptx_uboot_exec_single "Reloading new environment" 10 "loadenv"
