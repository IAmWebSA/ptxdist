
define flash {
	ptx_test_start "Flashing \%2"
	
	if = \m(u_boot_version) 2 {
		ptx_uboot_exec 5 "\%2=\%1"
		ptx_uboot_exec 120 "update_\%2"
	} else {
		ptx_uboot_exec 5 "setenv \%2 \%1"
		ptx_uboot_exec 120 "run update_\%2"
	}
	ptx_test_end
}

#Read the library
take \%1/libptxdisttest.kermit

#Set up the line
ptx_init \%2

ptx_uboot_enter_shell

flash "\%3" "kernel"
flash "\%4" "rootfs"
if defined \%5 flash "\%5" "oftree"

ptx_exit
